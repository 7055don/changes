# -*- coding: utf-8 -*-
"""
ì£¼ì—­ 64ê´˜ Ã— 6íš¨ â†’ êµ­ë‚´ ì„¹í„°/ëŒ€í‘œ ì¢…ëª©/ì‹œê·¸ë„ ì„¤ëª… ë§¤í•‘ (ì½˜ì†” ì…ë ¥ í¬í•¨)
- ì…ë ¥: ê´˜(1~64), íš¨(1~6), top_k(ì„¹í„°ë³„ ëŒ€í‘œ ì¢…ëª© í‘œê¸° ê°œìˆ˜)
- í¬í•¨: 
  1) 64ê´˜ ì „ë¶€ ë©”íƒ€(ì´ë¦„/í•œì/ì„¹í„°/ë©”ëª¨)
  2) ê´˜ ì„±í–¥ë³„ ë³´ì • + ê´˜ë³„ íš¨ ì»¤ìŠ¤í…€ ë¬¸êµ¬
  3) ì„¹í„°â†’ëŒ€í‘œ ì¢…ëª© ì‚¬ì „(í•µì‹¬ ì„¹í„° 10~20ê°œì”© ë³´ê°•)
  4) ìë™ ì—…ë°ì´íŠ¸ í›…(fetcher) ì¸í„°í˜ì´ìŠ¤
"""
# app.py
# -*- coding: utf-8 -*-
import streamlit as st
import pandas as pd
from typing import Dict, List, Callable
from typing import Dict, List, Callable

# 1) íš¨ ë²ˆí˜¸(1~6) â†’ ë¼ë²¨
HYO_LABEL = {1: "ì´ˆ", 2: "2", 3: "3", 4: "4", 5: "5", 6: "ìƒ"}

# 2) ì„¹í„° â†’ ëŒ€í‘œ êµ­ë‚´ ì¢…ëª©(ë³´ê°•íŒ: ê° 10~20ê°œ ëª©í‘œ, ì¼ë¶€ 7~10ê°œ ìˆ˜ì¤€)
SECTOR_STOCKS: Dict[str, List[str]] = {
    # í˜ì‹ /ê¸°ìˆ 
    "AI/í”Œë«í¼": [
        "NAVER(035420)", "ì¹´ì¹´ì˜¤(035720)", "ë”ì¡´ë¹„ì¦ˆì˜¨(012510)", "NHNí´ë¼ìš°ë“œ(383310)",
        "ì†”íŠ¸ë£©ìŠ¤(304100)", "ì•Œì²´ë¼(347860)", "ë·°ë…¸(338220)", "ê°€ë¹„ì•„(079940)",
        "ë§ˆì¸ì¦ˆë©(377480)", "ì½”ë‚œí…Œí¬ë†€ë¡œì§€(402030)", "í”Œë¦¬í† (300080)", "ì˜¤í”ˆë² ì´ìŠ¤(049480)"
    ],
    "ë°˜ë„ì²´": [
        "ì‚¼ì„±ì „ì(005930)", "SKí•˜ì´ë‹‰ìŠ¤(000660)", "DBí•˜ì´í…(000990)", "í•œë¯¸ë°˜ë„ì²´(042700)",
        "ì›ìµIPS(240810)", "ë¦¬ë…¸ê³µì—…(058470)", "ìœ ì§„í…Œí¬(084370)", "ì£¼ì„±ì—”ì§€ë‹ˆì–´ë§(036930)",
        "í…ŒìŠ¤(095610)", "ë•ì‚°í…Œì½”í”¼ì•„(317330)", "ì†”ë¸Œë ˆì¸(357780)", "ë„¤íŒ¨ìŠ¤(033640)"
    ],
    "2ì°¨ì „ì§€": [
        "LGì—ë„ˆì§€ì†”ë£¨ì…˜(373220)", "ì‚¼ì„±SDI(006400)", "SKì´ë…¸ë² ì´ì…˜(096770)", "í¬ìŠ¤ì½”í“¨ì²˜ì— (003670)",
        "ì—ì½”í”„ë¡œë¹„ì— (247540)", "ì—ì½”í”„ë¡œ(086520)", "ì—˜ì•¤ì—í”„(066970)", "ì²œë³´(278280)",
        "ë‚˜ë…¸ì‹ ì†Œì¬(121600)", "í•œì†”ì¼€ë¯¸ì¹¼(014680)", "ëŒ€ì£¼ì „ìì¬ë£Œ(078600)", "ë™í™”ê¸°ì—…(025900)"
    ],
    "ë¡œë´‡/ìë™í™”": [
        "ë‘ì‚°ë¡œë³´í‹±ìŠ¤(448370)", "ë ˆì¸ë³´ìš°ë¡œë³´í‹±ìŠ¤(277810)", "ìœ ì§„ë¡œë´‡(056080)", "ë¡œë³´í‹°ì¦ˆ(108490)",
        "ë‰´ë¡œë©”ì¹´(348340)", "ì—ìŠ¤í”¼ì§€(058610)", "í‹°ë¡œë³´í‹±ìŠ¤(117730)", "ë¼ì˜¨í…Œí¬(232680)",
        "ì—ë¸Œë¦¬ë´‡(270660)"
    ],
    "í˜ì‹ ê¸°ìˆ ": [
        "ë‘ì‚°ë¡œë³´í‹±ìŠ¤(448370)", "NAVER(035420)", "ì¹´ì¹´ì˜¤(035720)", "í•œì»´MDS(086960)",
        "í•œê¸€ê³¼ì»´í“¨í„°(030520)", "ì—ì´í”„ë¡œì  (007460)"
    ],

    # ì—ë„ˆì§€/ì¸í”„ë¼
    "ì›ì „/ì „ë ¥": [
        "ë‘ì‚°ì—ë„ˆë¹Œë¦¬í‹°(034020)", "í•œêµ­ì „ë ¥ê¸°ìˆ (052690)", "í•œì „KPS(051600)", "ìš°ì§„(105840)",
        "ë³´ì„±íŒŒì›Œí…(006910)", "ì¼ì§„ì „ê¸°(103590)", "LS ELECTRIC(010120)", "íš¨ì„±ì¤‘ê³µì—…(298040)",
        "í•œì „ê¸°ìˆ (052690)"
    ],
    "íƒœì–‘ê´‘/ì¬ìƒì—ë„ˆì§€": [
        "í•œí™”ì†”ë£¨ì…˜(009830)", "í˜„ëŒ€ì—ë„ˆì§€ì†”ë£¨ì…˜(322000)", "OCIí™€ë”©ìŠ¤(010060)", "SDN(099220)",
        "ì‹ ì„±ì´ì—”ì§€(011930)", "ëŒ€ëª…ì—ë„ˆì§€(389260)", "íƒœì–‘ê¸ˆì†(004100)"
    ],
    "ìˆ˜ìì›/ì›ìì¬": [
        "í¬ìŠ¤ì½”í™€ë”©ìŠ¤(005490)", "OCIí™€ë”©ìŠ¤(010060)", "ìŒìš©C&E(003410)", "ì‚¼í‘œì‹œë©˜íŠ¸(038500)",
        "íš¨ì„±í™”í•™(298000)"
    ],

    # ì œì¡°/ì‚°ì—…/ìš´ì†¡
    "ê±´ì„¤/ì¸í”„ë¼/ì†Œì¬": [
        "í˜„ëŒ€ê±´ì„¤(000720)", "DLì´ì•¤ì”¨(375500)", "GSê±´ì„¤(006360)", "ëŒ€ìš°ê±´ì„¤(047040)",
        "í˜„ëŒ€ì œì² (004020)", "í¬ìŠ¤ì½”í™€ë”©ìŠ¤(005490)", "ìŒìš©C&E(003410)", "KCC(002380)"
    ],
    "ì¡°ì„ /í•´ìš´": [
        "HDí˜„ëŒ€ì¤‘ê³µì—…(329180)", "í•œí™”ì˜¤ì…˜(042660)", "ì‚¼ì„±ì¤‘ê³µì—…(010140)", "HMM(011200)",
        "íŒ¬ì˜¤ì…˜(028670)", "ëŒ€í•œí•´ìš´(005880)", "KSSí•´ìš´(044450)"
    ],
    "ì „ê¸°ì°¨/ë¶€í’ˆ": [
        "í˜„ëŒ€ì°¨(005380)", "ê¸°ì•„(000270)", "í˜„ëŒ€ëª¨ë¹„ìŠ¤(012330)", "ë§Œë„(204320)",
        "í•œì˜¨ì‹œìŠ¤í…œ(018880)", "ëŒ€ì›ê°•ì—…(000430)"
    ],
    "ë°°í„°ë¦¬ì†Œì¬/ë¦¬ì‚¬ì´í´": [
        "ì„±ì¼í•˜ì´í…(365340)", "ìƒˆë¹—ì¼(107600)", "í¬ìŠ¤ì½”DX(022100)", "ì§€ì—”ì›ì—ë„ˆì§€(270520)"
    ],

    # í†µì‹ /ë¯¸ë””ì–´/ì½˜í…ì¸ 
    "í†µì‹ /ë„¤íŠ¸ì›Œí¬": [
        "SKí…”ë ˆì½¤(017670)", "KT(030200)", "LGìœ í”ŒëŸ¬ìŠ¤(032640)", "ì¼€ì´í‹°ìŠ¤ì¹´ì´ë¼ì´í”„(053210)"
    ],
    "ì—”í„°/ë¯¸ë””ì–´": [
        "í•˜ì´ë¸Œ(352820)", "JYP Ent.(035900)", "ì—ìŠ¤ì— (041510)", "ìŠ¤íŠœë””ì˜¤ë“œë˜ê³¤(253450)",
        "CJ ENM(035760)", "ë±ìŠ¤í„°(206560)"
    ],
    "ê²Œì„": [
        "í¬ë˜í”„í†¤(259960)", "ë„·ë§ˆë¸”(251270)", "ì—”ì”¨ì†Œí”„íŠ¸(036570)", "ì¹´ì¹´ì˜¤ê²Œì„ì¦ˆ(293490)",
        "ë„¤ì˜¤ìœ„ì¦ˆ(095660)", "ìœ„ë©”ì´ë“œ(112040)", "í„ì–´ë¹„ìŠ¤(263750)"
    ],
    "íŒ¨ì…˜/ë¯¸ë””ì–´/ê´‘ê³ ": [
        "F&F(383220)", "ì œì¼ê¸°íš(030000)", "ìŠ¤íŠœë””ì˜¤ë“œë˜ê³¤(253450)", "LF(093050)"
    ],

    # ê¸ˆìœµ/ë¦¬ì¸ /ë°©ì–´
    "ì€í–‰/ê¸ˆìœµì§€ì£¼": [
        "KBê¸ˆìœµ(105560)", "ì‹ í•œì§€ì£¼(055550)", "í•˜ë‚˜ê¸ˆìœµì§€ì£¼(086790)", "ê¸°ì—…ì€í–‰(024110)"
    ],
    "ë³´í—˜/ì—°ê¸ˆ": [
        "ì‚¼ì„±í™”ì¬(000810)", "ì‚¼ì„±ìƒëª…(032830)", "DBì†í•´ë³´í—˜(005830)", "í˜„ëŒ€í•´ìƒ(001450)"
    ],
    "ë¦¬ì¸ /ì¸í”„ë¼í€ë“œ": [
        "ë¡¯ë°ë¦¬ì¸ (330590)", "SKë¦¬ì¸ (395400)", "NHì˜¬ì›ë¦¬ì¸ (400760)", "ì½”ëŒì½”ì—ë„ˆì§€ë¦¬ì¸ (357120)"
    ],
    "ETF/ì§€ìˆ˜": [
        "KODEX200(069500)", "TIGER200(102110)", "KODEX ì½”ìŠ¤ë‹¥150(229200)", "TIGER ë‚˜ìŠ¤ë‹¥100(133690)"
    ],
    "ë¶„ì‚°íˆ¬ì/ETF": [
        "KODEX200(069500)", "TIGER ë‚˜ìŠ¤ë‹¥100(133690)", "KODEX ë¯¸êµ­S&P500TR(379800)"
    ],

    # ì†Œë¹„/ì„œë¹„ìŠ¤
    "ì†Œë¹„ì¬/ìœ í†µ": [
        "ì‹ ì„¸ê³„(004170)", "ì´ë§ˆíŠ¸(139480)", "ë¡¯ë°ì‡¼í•‘(023530)", "BGFë¦¬í…Œì¼(282330)",
        "GSë¦¬í…Œì¼(007070)", "ì¿ íŒ¡(CPNG,ADR)"
    ],
    "ê°€ì „/ìƒí™œì†Œë¹„": [
        "LGì „ì(066570)", "ì¿ ì¿ í™ˆì‹œìŠ¤(284740)", "í•œìƒ˜(009240)", "ì¿ ì²¸(225650)"
    ],
    "ì—¬í–‰/í•­ê³µ/ë¦¬ì˜¤í”„ë‹": [
        "ëŒ€í•œí•­ê³µ(003490)", "ì•„ì‹œì•„ë‚˜í•­ê³µ(020560)", "ì œì£¼í•­ê³µ(089590)", "í˜¸í…”ì‹ ë¼(008770)", "í•˜ë‚˜íˆ¬ì–´(039130)"
    ],
    "ì†Œë¹„/ë¼ì´í”„ìŠ¤íƒ€ì¼": [
        "ì•„ëª¨ë ˆí¼ì‹œí”½(090430)", "ì½”ìŠ¤ë§¥ìŠ¤(192820)", "F&F(383220)", "LF(093050)", "ì• ê²½ì‚°ì—…(018250)"
    ],
    "í•„ìˆ˜ì†Œë¹„/ì¥ê¸°ë³´ìœ ": [
        "KT&G(033780)", "BGFë¦¬í…Œì¼(282330)", "ì˜¤ëšœê¸°(007310)", "ë†ì‹¬(004370)"
    ],
    # í—¬ìŠ¤/í…Œë§ˆ/í•€í…Œí¬
    "í—¬ìŠ¤ì¼€ì–´/ë°”ì´ì˜¤": [
        "ì…€íŠ¸ë¦¬ì˜¨(068270)", "ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤(207940)", "ìœ í•œì–‘í–‰(000100)", "í•œë¯¸ì•½í’ˆ(128940)",
        "ì—ìŠ¤í‹°íŒœ(237690)", "SKë°”ì´ì˜¤ì‚¬ì´ì–¸ìŠ¤(302440)", "HLB(028300)", "ë©”ë””í†¡ìŠ¤(086900)"
    ],
    "í•€í…Œí¬/ê²°ì œ": [
        "ì¹´ì¹´ì˜¤í˜ì´(377300)", "NHN KCP(060250)", "KGì´ë‹ˆì‹œìŠ¤(035600)"
    ],
    "êµ­ë°©/ë³´ì•ˆ": [
        "í•œí™”ì—ì–´ë¡œìŠ¤í˜ì´ìŠ¤(012450)", "LIGë„¥ìŠ¤ì›(079550)", "í•œí™”ì‹œìŠ¤í…œ(272210)",
        "í•œêµ­í•­ê³µìš°ì£¼(047810)", "í’ì‚°(103140)", "ë¹…í…(065450)", "í•œì¼ë‹¨ì¡°(024740)"
    ],

    # ê´€ë¦¬ìš© ê·¸ë£¹
    "ê·œì œ/ê¸ˆìœµê°ë…": ["ì€í–‰ì£¼ ì „ë°˜", "í•€í…Œí¬ ê·œì œ ë¯¼ê°ì£¼"],
}

# 3) 64ê´˜ ë©”íƒ€(ë²ˆí˜¸, í•œê¸€ëª…, í•œì, ê¸°ë³¸ ì„¹í„° ë¼ë²¨, ë©”ëª¨)
HEXAGRAM_META: Dict[int, Dict] = {
    1:  {"name": "ê±´",  "hanja": "ä¹¾", "sectors": ["AI/í”Œë«í¼", "ë°˜ë„ì²´", "2ì°¨ì „ì§€"], "notes": "í•˜ëŠ˜/ì°½ì¡°. í˜ì‹  ì£¼ë„ ì¶• ì§‘ì¤‘."},
    2:  {"name": "ê³¤",  "hanja": "å¤", "sectors": ["ê±´ì„¤/ì¸í”„ë¼/ì†Œì¬"], "notes": "ë•…/ìˆ˜ìš©. ì¸í”„ë¼ ì‚¬ì´í´."},
    3:  {"name": "ë‘”",  "hanja": "å±¯", "sectors": ["í—¬ìŠ¤ì¼€ì–´/ë°”ì´ì˜¤"], "notes": "ì‹œì‘/ì–´ë ¤ì›€. ì´ˆê¸° ë¦¬ìŠ¤í¬ ê´€ë¦¬."},
    4:  {"name": "ëª½",  "hanja": "è’™", "sectors": ["êµìœ¡/ì½˜í…ì¸ /ì—ë“€í…Œí¬"], "notes": "ì–´ë‘ /ë°°ì›€. ê²€ì¦Â·ë¦¬ì„œì¹˜."},
    5:  {"name": "ìˆ˜",  "hanja": "éœ€", "sectors": ["ì›ì „/ì „ë ¥", "ê±´ì„¤/ì¸í”„ë¼/ì†Œì¬"], "notes": "ê¸°ë‹¤ë¦¼/ìì›. ì¸í—ˆê°€Â·ë°œì£¼ ëŒ€ê¸°."},
    6:  {"name": "ì†¡",  "hanja": "è¨Ÿ", "sectors": ["AI/í”Œë«í¼", "í—¬ìŠ¤ì¼€ì–´/ë°”ì´ì˜¤"], "notes": "ë¶„ìŸ/ê°ˆë“±. ê·œì œ ë¯¼ê° ì—…ì¢…."},
    7:  {"name": "ì‚¬",  "hanja": "å¸«", "sectors": ["êµ­ë°©/ë³´ì•ˆ", "ë¬¼ë¥˜"], "notes": "êµ°ëŒ€/ì§‘ë‹¨. ê³µê³µë§Â·ë°©ì‚°."},
    8:  {"name": "ë¹„",  "hanja": "æ¯”", "sectors": ["í•©ì‘/íŒŒíŠ¸ë„ˆì‹­", "M&A/ì¸ìˆ˜í•©ë³‘"], "notes": "í˜‘ë ¥/ë™ë§¹. ì»¨ì†Œì‹œì—„Â·ì§€ë¶„."},
    9:  {"name": "ì†Œì¶•","hanja": "å°ç•œ", "sectors": ["í—¬ìŠ¤ì¼€ì–´/ë°”ì´ì˜¤"], "notes": "ì†Œì¶•ì /ì œì•½. ì„ìƒ ì§„ì „ ëˆ„ì ."},
    10: {"name": "ë¦¬",  "hanja": "å±¥", "sectors": ["ì†Œë¹„ì¬/ìœ í†µ"], "notes": "ë°ŸìŒ/í–‰ë™. ì†Œë¹„ ì‹¬ë¦¬ ë¯¼ê°."},
    11: {"name": "íƒœ",  "hanja": "æ³°", "sectors": ["ì€í–‰/ê¸ˆìœµì§€ì£¼", "ê±´ì„¤/ì¸í”„ë¼/ì†Œì¬"], "notes": "íƒœí‰/ìˆœí™˜. ê²½ê¸° í™•ì¥."},
    12: {"name": "ë¹„",  "hanja": "å¦", "sectors": ["ë¦¬ì¸ /ì¸í”„ë¼í€ë“œ"], "notes": "ë§‰í˜/ì •ì²´. ë°©ì–´Â·í˜„ê¸ˆë¹„ì¤‘."},
    13: {"name": "ë™ì¸","hanja": "åŒäºº", "sectors": ["AI/í”Œë«í¼"], "notes": "ë™ì§€/ì—°ëŒ€. ë„¤íŠ¸ì›Œí¬ íš¨ê³¼."},
    14: {"name": "ëŒ€ìœ ","hanja": "å¤§æœ‰", "sectors": ["ë°˜ë„ì²´", "ì€í–‰/ê¸ˆìœµì§€ì£¼"], "notes": "í° ì†Œìœ . ë©”ê°€ìº¡ ë¦¬ë”ì‹­."},
    15: {"name": "ê²¸",  "hanja": "è¬™", "sectors": ["ë¦¬ì¸ /ì¸í”„ë¼í€ë“œ", "ì€í–‰/ê¸ˆìœµì§€ì£¼"], "notes": "ê²¸ì†/ë‚´ì‹¤. ê°€ì¹˜Â·ì•ˆì •."},
    16: {"name": "ì˜ˆ",  "hanja": "è±«", "sectors": ["ì—”í„°/ë¯¸ë””ì–´", "ê²Œì„"], "notes": "ì¦ê±°ì›€/ê¸°ëŒ€. í¥í–‰Â·ì‹¬ë¦¬."},
    17: {"name": "ìˆ˜",  "hanja": "éš¨", "sectors": ["ì „ê¸°ì°¨/ë¶€í’ˆ"], "notes": "ë”°ë¦„/ìˆœì‘. í•˜ìœ„ ë°¸ë¥˜ì²´ì¸."},
    18: {"name": "ê³ ",  "hanja": "è ±", "sectors": ["ë¶€ì‹¤/íšŒìƒ"], "notes": "ë¶€íŒ¨/ê°œí˜. í„´ì–´ë¼ìš´ë“œ ëª¨ìƒ‰."},
    19: {"name": "ë¦¼",  "hanja": "è‡¨", "sectors": ["ì—¬í–‰/í•­ê³µ/ë¦¬ì˜¤í”„ë‹", "AI/í”Œë«í¼"], "notes": "ì„ë°•/ì ‘ê·¼. ìº˜ë¦°ë” ë“œë¦¬ë¸."},
    20: {"name": "ê´€",  "hanja": "è§€", "sectors": ["êµìœ¡/ì½˜í…ì¸ /ì—ë“€í…Œí¬", "AI/í”Œë«í¼"], "notes": "ê´€ì°°/í‰ê°€. ë¦¬ì„œì¹˜ ê°•í™”."},
    21: {"name": "ì„œí•©","hanja": "å™¬å—‘", "sectors": ["ë²•ë¥ /ê·œì œë¯¼ê°", "ë¬¸ì œí•´ê²°í˜•"], "notes": "ì”¹ìŒ/í•´ê²°. ì¸í—ˆê°€Â·ì‹¬ì‚¬ í†µê³¼."},
    22: {"name": "ë¹„",  "hanja": "è³", "sectors": ["íŒ¨ì…˜/ë¯¸ë””ì–´/ê´‘ê³ ", "ì—”í„°/ë¯¸ë””ì–´"], "notes": "ê¾¸ë°ˆ/ë””ìì¸. ë¸Œëœë”©."},
    23: {"name": "ë°•",  "hanja": "å‰", "sectors": ["ë¶€ì‹¤/íšŒìƒ"], "notes": "ê¹ì„/ì‡ í‡´. ë””ë ˆì´íŒ… ê²½ê³„."},
    24: {"name": "ë³µ",  "hanja": "å¾©", "sectors": ["ì—¬í–‰/í•­ê³µ/ë¦¬ì˜¤í”„ë‹"], "notes": "ëŒì•„ì˜´/íšŒë³µ. ë¦¬ë°”ìš´ë“œ."},
    25: {"name": "ë¬´ë§","hanja": "ç„¡å¦„", "sectors": ["AI/í”Œë«í¼", "ì—”í„°/ë¯¸ë””ì–´"], "notes": "ëœ»ë°–/ìˆœìˆ˜. ëŒë°œ ì¬ë£Œ."},
    26: {"name": "ëŒ€ì¶•","hanja": "å¤§ç•œ", "sectors": ["ì€í–‰/ê¸ˆìœµì§€ì£¼"], "notes": "í° ì¶•ì . ìë³¸ë ¥Â·ë°°ë‹¹."},
    27: {"name": "ì´",  "hanja": "é ¤", "sectors": ["ì‹í’ˆ/ë†ì—…"], "notes": "ì–‘ìœ¡/ë¨¹ì„. ë°©ì–´ ìˆ˜ìš”."},
    28: {"name": "ëŒ€ê³¼","hanja": "å¤§é", "sectors": ["2ì°¨ì „ì§€"], "notes": "í° ê³¼ë¶€í•˜. ë ˆë²„ë¦¬ì§€/ë²„ë¸” ê²½ê³„."},
    29: {"name": "ê°",  "hanja": "å", "sectors": ["í—¬ìŠ¤ì¼€ì–´/ë°”ì´ì˜¤"], "notes": "ë¬¼/ìœ„í—˜. ë³€ë™ì„±Â·ì„ìƒ."},
    30: {"name": "ë¦¬",  "hanja": "é›¢", "sectors": ["íƒœì–‘ê´‘/ì¬ìƒì—ë„ˆì§€", "ì—”í„°/ë¯¸ë””ì–´"], "notes": "ë¶ˆ/ë¹›. ê°€ì‹œì„±Â·ëª¨ë©˜í…€."},
    31: {"name": "í•¨",  "hanja": "å’¸", "sectors": ["ì†Œë¹„/ë¼ì´í”„ìŠ¤íƒ€ì¼", "ì†Œë¹„ì¬/ìœ í†µ"], "notes": "ê°ì‘/ì—°ì• . ì·¨í–¥Â·ë¸Œëœë“œ."},
    32: {"name": "í•­",  "hanja": "æ’", "sectors": ["ë¦¬ì¸ /ì¸í”„ë¼í€ë“œ", "í•„ìˆ˜ì†Œë¹„/ì¥ê¸°ë³´ìœ "], "notes": "í•­ìƒ/ì§€ì†. ê¾¸ì¤€í•¨."},
    33: {"name": "ëˆ",  "hanja": "é¯", "sectors": ["ë¦¬ì¸ /ì¸í”„ë¼í€ë“œ"], "notes": "ë„ë§/í‡´ê°. ë°©ì–´Â·í˜„ê¸ˆ."},
    34: {"name": "ëŒ€ì¥","hanja": "å¤§å£¯", "sectors": ["ê±´ì„¤/ì¸í”„ë¼/ì†Œì¬", "ì¡°ì„ /í•´ìš´"], "notes": "í° ì¥ì„±. ê°€ì† êµ­ë©´."},
    35: {"name": "ì§„",  "hanja": "æ™‰", "sectors": ["ì‹ ì„±ì¥/ì¹œí™˜ê²½", "2ì°¨ì „ì§€"], "notes": "ì§„ë³´/ìƒìŠ¹. ì¹œí™˜ê²½ ì„±ì¥."},
    36: {"name": "ëª…ì´","hanja": "æ˜å¤·", "sectors": ["ê·œì œ/ê¸ˆìœµê°ë…"], "notes": "ë¹›ì˜ ìƒì²˜. ê·œì œ ë¦¬ìŠ¤í¬."},
    37: {"name": "ê°€ì¸","hanja": "å®¶äºº", "sectors": ["ê°€ì „/ìƒí™œì†Œë¹„", "ì†Œë¹„ì¬/ìœ í†µ"], "notes": "ê°€ì¡±/ê°€ì •. ìƒí™œ ë°€ì°©."},
    38: {"name": "ê·œ",  "hanja": "ç½", "sectors": ["AI/í”Œë«í¼", "ìœ í†µ/ë¬´ì—­"], "notes": "ì–´ê¸‹ë‚¨/ê°ˆë“±. ê²½ìŸ ì‹¬í™”."},
    39: {"name": "ê±´",  "hanja": "è¹‡", "sectors": ["ë¶€ì‹¤/íšŒìƒ"], "notes": "ë§‰í˜/ë‚œê´€. ìœ ë™ì„± ì œì•½."},
    40: {"name": "í•´",  "hanja": "è§£", "sectors": ["ê±´ì„¤/ì¸í”„ë¼/ì†Œì¬", "ì›ì „/ì „ë ¥"], "notes": "í’€ë¦¼/í•´ê²°. ë¦¬ë ˆì´íŒ…."},
    41: {"name": "ì†",  "hanja": "æ", "sectors": ["ì€í–‰/ê¸ˆìœµì§€ì£¼", "ë³´í—˜/ì—°ê¸ˆ"], "notes": "ì†ì‹¤/ì ˆì œ. ê¸´ì¶•Â·ë§ˆì§„."},
    42: {"name": "ìµ",  "hanja": "ç›Š", "sectors": ["ì „ê¸°ì°¨/ë¶€í’ˆ", "ì‹ ì„±ì¥/ì¹œí™˜ê²½"], "notes": "ì´ìµ/í™•ëŒ€. ì •ì±…/ìˆ˜ì¶œ."},
    43: {"name": "ì¾Œ",  "hanja": "å¤¬", "sectors": ["M&A/ì¸ìˆ˜í•©ë³‘"], "notes": "ê²°ë‹¨/ë‹¨í˜¸. ë”œ ëª¨ë©˜í…€."},
    44: {"name": "êµ¬",  "hanja": "å§¤", "sectors": ["ì—”í„°/ë¯¸ë””ì–´", "AI/í”Œë«í¼"], "notes": "ìš°ì—°/ë§Œë‚¨. ê¹œì§ ì¬ë£Œ."},
    45: {"name": "ì·Œ",  "hanja": "èƒ", "sectors": ["ETF/ì§€ìˆ˜"], "notes": "ëª¨ì„/ì§‘í•©. ìê¸ˆ ê²°ì§‘."},
    46: {"name": "ìŠ¹",  "hanja": "å‡", "sectors": ["ë°˜ë„ì²´"], "notes": "ì˜¤ë¦„/ìŠ¹ì§„. ì¶”ì„¸ ê°•í™”."},
    47: {"name": "ê³¤",  "hanja": "å›°", "sectors": ["ë¶€ì‹¤/íšŒìƒ"], "notes": "ê³¤ê¶/ìœ„ê¸°. ì¦ìÂ·ìœ ì¦."},
    48: {"name": "ì •",  "hanja": "äº•", "sectors": ["ì›ì „/ì „ë ¥", "ìˆ˜ìì›/ì›ìì¬"], "notes": "ìš°ë¬¼/ìì›. í•„ìˆ˜ ì¸í”„ë¼."},
    49: {"name": "í˜",  "hanja": "é©", "sectors": ["í˜ì‹ ê¸°ìˆ ", "AI/í”Œë«í¼"], "notes": "í˜ì‹ /ê°œí˜. ì „í™˜Â·ë””ìŠ¤ëŸ½ì…˜."},
    50: {"name": "ì •",  "hanja": "é¼", "sectors": ["í•„ìˆ˜ì†Œë¹„/ì¥ê¸°ë³´ìœ "], "notes": "ì†¥/ì•ˆì •. ìƒí™œ í•„ìˆ˜."},
    51: {"name": "ì§„",  "hanja": "éœ‡", "sectors": ["ì›ì „/ì „ë ¥", "ì „ê¸°ì°¨/ë¶€í’ˆ"], "notes": "ìš°ë ˆ/ì§„ë™. ì í™”Â·ì¶©ê²©."},
    52: {"name": "ê°„",  "hanja": "è‰®", "sectors": ["ë¦¬ì¸ /ì¸í”„ë¼í€ë“œ"], "notes": "ì‚°/ë©ˆì¶¤. ë°©ì–´Â·ê´€ë§."},
    53: {"name": "ì ",  "hanja": "æ¼¸", "sectors": ["í•„ìˆ˜ì†Œë¹„/ì¥ê¸°ë³´ìœ ", "ì•ˆì •ì„±ì¥"], "notes": "ì ì§„/ì„œì„œíˆ. ë³µë¦¬."},
    54: {"name": "ê·€ë§¤","hanja": "æ­¸å¦¹", "sectors": ["í•©ë³‘/íŒŒíŠ¸ë„ˆì‹­", "M&A/ì¸ìˆ˜í•©ë³‘"], "notes": "ê²°í•©/ê²°í˜¼. ì œíœ´Â·ì¡°ì¸íŠ¸."},
    55: {"name": "í’",  "hanja": "è±", "sectors": ["2ì°¨ì „ì§€", "ì‹ ì„±ì¥/ì¹œí™˜ê²½"], "notes": "í’ìš”/ì„±ì¥. ì–´ë‹ ì„œí”„ë¼ì´ì¦ˆ."},
    56: {"name": "ë ¤",  "hanja": "æ—…", "sectors": ["ì—¬í–‰/í•­ê³µ/ë¦¬ì˜¤í”„ë‹"], "notes": "ì—¬í–‰/ì´ë™. ìˆ˜ìš” íšŒë³µ."},
    57: {"name": "ì†",  "hanja": "å·½", "sectors": ["í†µì‹ /ë„¤íŠ¸ì›Œí¬", "AI/í”Œë«í¼"], "notes": "ë°”ëŒ/ìˆœì¢…. ì¹¨íˆ¬Â·í™•ì‚°."},
    58: {"name": "íƒœ",  "hanja": "å…Œ", "sectors": ["ì†Œë¹„ì¬/ìœ í†µ", "ìœ í†µ/ë¬´ì—­"], "notes": "ê¸°ì¨/êµí™˜. ê±°ë˜ í™œì„±."},
    59: {"name": "í™˜",  "hanja": "æ¸™", "sectors": ["ë¶„ì‚°íˆ¬ì/ETF", "ETF/ì§€ìˆ˜"], "notes": "í©ì–´ì§/ë¶„ì‚°. ë¦¬ë°¸ëŸ°ì‹±."},
    60: {"name": "ì ˆ",  "hanja": "ç¯€", "sectors": ["ê·œì œ/ê¸ˆìœµê°ë…", "ì€í–‰/ê¸ˆìœµì§€ì£¼"], "notes": "ì ˆì œ/ê·œìœ¨. íš¨ìœ¨í™”."},
    61: {"name": "ì¤‘ë¶€","hanja": "ä¸­å­š", "sectors": ["ESG/ì‹ ë¢°", "í•„ìˆ˜ì†Œë¹„/ì¥ê¸°ë³´ìœ "], "notes": "ì§„ì‹¤/ì‹ ë¢°. ë¸Œëœë“œ."},
    62: {"name": "ì†Œê³¼","hanja": "å°é", "sectors": ["ê²Œì„", "ì—”í„°/ë¯¸ë””ì–´"], "notes": "ì‘ì€ ê³¼ë„. ìŠ¤ìº˜í•‘Â·ë‹¨ê¸°."},
    63: {"name": "ê¸°ì œ","hanja": "æ—¢æ¿Ÿ", "sectors": ["í•„ìˆ˜ì†Œë¹„/ì¥ê¸°ë³´ìœ ", "ë¦¬ì¸ /ì¸í”„ë¼í€ë“œ"], "notes": "ì´ë¯¸ ì„±ì·¨. ì•ˆì • ì¶”ì„¸."},
    64: {"name": "ë¯¸ì œ","hanja": "æœªæ¿Ÿ", "sectors": ["AI/í”Œë«í¼", "í—¬ìŠ¤ì¼€ì–´/ë°”ì´ì˜¤"], "notes": "ì•„ì§ ë¯¸ì™„. ê³ ë³€ë™."},
}

# 4) íš¨ ê¸°ë³¸í˜•(ê³µí†µ) + ì„±í–¥ ë³´ì • ê·¸ë£¹ + ê´˜ë³„ ì»¤ìŠ¤í…€ ë¬¸êµ¬
DEFAULT_EFF_BASE = {
    "ì´ˆ": "ì´ˆê¸° ì‹ í˜¸. ë¯¸ë°˜ì˜ ë‰´ìŠ¤ íƒì§€ ë‹¨ê³„. ì†Œì•¡ ê´€ì°° ì§„ì… ê¶Œì¥.",
    "2":  "ì•ˆì • ì„±ì¥ ì´ˆì…. ìˆ˜ê¸‰ ìœ ì… í™•ì¸ ì‹œ ë¶„í•  ë§¤ìˆ˜.",
    "3":  "ê³¼ì—´ ê¸°ëŒ€Â·ë…¸ì´ì¦ˆ í˜¼ì¬. ë‹¨íƒ€ì£¼ì˜, ì†ì ˆ ì—„ê²©(-3%).",
    "4":  "ë³¸ê²© ìƒìŠ¹Â·ê°€ì† êµ¬ê°„. ëŒíŒŒ ë™ë°˜ ì‹œ ì¶”ì„¸ ì¶”ì¢….",
    "5":  "ì£¼ë„ì£¼ ìë¦¬. ê°•ì„¸ í™•ì •, ì¼ë¶€ ìµì ˆ + ì´ë™ì†ì ˆ.",
    "ìƒ": "ê³¼ì—´ ì •ì  ìœ„í—˜. ì°¨ìµ ì‹¤í˜„Â·ë¹„ì¤‘ ì¶•ì†Œ, ì‹ ê·œ ì§„ì… ë³´ìˆ˜ì .",
}

RISKY = {3, 18, 23, 28, 29, 39, 44, 47, 62, 64}
POLICY_EXPANSION = {5, 7, 11, 19, 26, 34, 35, 40, 41, 42, 45, 46, 48, 49, 51, 57, 60}
GROWTH_LEADER = {1, 14, 30, 32, 35, 42, 50, 55, 63}
DEFENSIVE = {2, 12, 15, 20, 22, 27, 31, 33, 36, 37, 52, 53, 61}

CUSTOM_HYO_TEXT: Dict[int, Dict[str, str]] = {
    1:  {"ì´ˆ": "ì´ˆê¸° ì‹ í˜¸, ë¯¸ë°˜ì˜ ë‰´ìŠ¤.", "2": "ì•ˆì • ì„±ì¥, ê¸°ê´€ ê´€ì‹¬.", "3": "ê³¼ì—´ ê¸°ëŒ€, ë‹¨íƒ€ì£¼ì˜.",
         "4": "ë³¸ê²© ìƒìŠ¹, ê°€ì† êµ¬ê°„.", "5": "ì£¼ë„ì£¼ ìë¦¬, ê°•ì„¸ í™•ì •.", "ìƒ": "ê³¼ì—´ ì •ì , ì°¨ìµì‹¤í˜„ ìœ„í—˜."},
    5:  {"ì´ˆ": "ì¸í—ˆê°€/ë°œì£¼ íŒíŠ¸ í¬ì°©.", "2": "ìì›Â·ê³µê¸‰ë§ ìœ¤ê³½, ë¶„í•  ë§¤ìˆ˜.", "4": "ì§‘í–‰ ì‹ í˜¸ ì‹œ ê°€ì†.", "5": "ê³„ì•½ í™•ì •, ë¹„ì¤‘ ìƒí–¥."},
    7:  {"2": "êµ­ë°© ìˆ˜ì£¼ íŒŒì´í”„ë¼ì¸ ì ê²€ í›„ ë¶„í• .", "4": "ìˆ˜ì¶œ ê³„ì•½ í™•ì • ì‹œ ê°€ì†."},
    11: {"4": "ì§€ìˆ˜ ì „í™˜Â·ê²½ê¸° í™•ì¥ ì‹ í˜¸ ë™í–‰.", "5": "í™•ì¥ í”¼í¬ ì ê²€, ì¼ë¶€ ìµì ˆ."},
    14: {"2": "ë©”ê°€ìº¡ ì‹¤ì  ìƒí–¥ í™•ì¸.", "4": "ì‹ ê³ ê°€ ëŒíŒŒ ì¶”ì¢….", "5": "ì£¼ë„ê¶Œ ê·¹ëŒ€í™”, ê´€ë¦¬ ë³‘í–‰."},
    16: {"3": "í¥í–‰ ë¶ˆí™•ì‹¤ì„± ì£¼ì˜.", "4": "ì§€í‘œ(ì‚¬ì „ì˜ˆì•½/ì°¨íŠ¸) í™•ì¸ ì‹œ ì¶”ì¢….", "5": "í¥í–‰ í™•ì •, ì¼ë¶€ ìµì ˆ."},
    18: {"3": "ì¬ë¬´/íšŒê³„ ë¦¬ìŠ¤í¬ ì¬í™•ì¸. ì¶”ê²© ê¸ˆì§€.", "4": "ê°œì„  ì¦ê±° í™•ì¸ ì‹œ ì œí•œì  ì ‘ê·¼."},
    19: {"ì´ˆ": "ìƒì¥Â·ê³µëª¨ ì¼ì • ì²´í¬.", "2": "ìˆ˜ìš”ì˜ˆì¸¡Â·ì˜ë¬´ë³´ìœ  í™•ì¸.", "4": "ìƒì¥ ì²«ë‚  ë³€ë™ì„± ê´€ë¦¬."},
    21: {"4": "ì¸í—ˆê°€/ì‹¬ì‚¬ í†µê³¼ í™•ì • ì‹œ ê¸‰ê°€ì†.", "5": "í†µê³¼ í›„ ì¬í‰ê°€ êµ¬ê°„."},
    22: {"2": "ë¸Œëœë“œ/ë””ìì¸ ëª¨ë©˜í…€ í™•ì‚°.", "4": "ìº í˜ì¸Â·í¥í–‰ ë™ë°˜ ì‹œ ê°€ì†."},
    24: {"2": "ë¦¬ì˜¤í”„ë‹ ìˆ˜ìš” íšŒë³µ í™•ì¸.", "4": "ì‹¤ìˆ˜ìš” ë°ì´í„° ê°€ì† ì‹œ ì¶”ì¢….", "5": "í”¼í¬ì•„ì›ƒ ì ê²€."},
    26: {"2": "ìë³¸ ì¶•ì Â·ë°°ë‹¹ ì •ì±… í™•ì¸.", "4": "ëŒ€ê·œëª¨ íˆ¬ìÂ·M&A ì§‘í–‰ ì‹œ ê°€ì†."},
    28: {"3": "ë ˆë²„ë¦¬ì§€/ë²„ë¸” ê²½ê³ . ì†ì ˆ ì—„ê²©.", "ìƒ": "ë¦¬ìŠ¤í¬ ê¸‰ë“±. ì¶•ì†Œ/ì²­ì‚°."},
    29: {"3": "ê°€ì§œ ëŒíŒŒ ë¹ˆë²ˆ. ì†ì ˆ -3% ì—„ìˆ˜.", "4": "í™•ì¦ ë‰´ìŠ¤ ë™ë°˜ ì‹œì—ë§Œ ì¶”ì¢….", "ìƒ": "ì¬ë£Œ ë¯¸í™•ì¦ ì‹œ ì²­ì‚°."},
    30: {"2": "ê°€ì‹œì„±/ëª¨ë©˜í…€ ê°œì„ . ìˆ˜ê¸‰ ë™ë°˜ ì‹œ ë¶„í• .", "4": "ëŒíŒŒ+ê±°ë˜ëŒ€ê¸ˆ ê¸‰ì¦ ì‹œ ê°€ì†.", "5": "ëª¨ë©˜í…€ í”¼í¬ ê²½ê³„."},
    32: {"2": "ì§€ì† ë§¤ì¶œ/ARR í™•ì¸.", "5": "ì¥ê¸° ë³µë¦¬ êµ¬ê°„, ë³´ìœ  ìš°ìœ„."},
    34: {"4": "ë°œì£¼/ìˆ˜ì¶œ ê³„ì•½ ë™ë°˜ ê°€ì†.", "5": "ì‚¬ì´í´ ì¤‘í›„ë°˜, ìµì ˆ ë³‘í–‰."},
    35: {"2": "ì¹œí™˜ê²½ ë¡œë“œë§µ í™•ì¸.", "4": "ë³´ì¡°ê¸ˆ/ìˆ˜ì£¼ í™•ì • ì‹œ ê°€ì†."},
    40: {"4": "ë¬¸ì œ í•´ì†Œ í™•ì¸ ì‹œ ë¦¬ë ˆì´íŒ… ê°€ì†.", "5": "ì²´ì§ˆê°œì„  ë°˜ì˜, ì¼ë¶€ ìµì ˆ."},
    41: {"2": "ë¹„ìš© ì ˆê°Â·íš¨ìœ¨í™” ì„±ê³¼ í™•ì¸.", "5": "ë°°ë‹¹/ìë³¸ì •ì±… ì•ˆì •í™”."},
    42: {"ì´ˆ": "ì •ì±… íŒíŠ¸ ë‹¨ê³„. ë¡œë“œë§µÂ·ì˜ˆì‚° ì²´í¬.", "3": "ê¸°ëŒ€ ì„ ë°˜ì˜ ì£¼ì˜.", "4": "ë°œì£¼/ìˆ˜ì£¼ í™•ì • ì‹œ ê°€ì†.", "5": "ìˆ˜í˜œ í™•ì •. ë¹„ì¤‘ ìƒí–¥ í›„ ìµì ˆ ë¶„í• ."},
    45: {"2": "ìê¸ˆì§‘ì¤‘ ETFÂ·ë°”ìŠ¤ì¼“ í¬ì°©.", "4": "ì§€ìˆ˜ ëŒíŒŒ ì‹œ ë™í–‰."},
    46: {"2": "ìš°ìƒí–¥ ì¶”ì„¸ í™•ì¸ í›„ ë¶„í• .", "4": "ëŒíŒŒ ê°€ì†, ì¶”ì„¸ ì¶”ì¢…."},
    48: {"2": "ì¸í”„ë¼ ìœ ì§€ë³´ìˆ˜ ê³„ì•½ í™•ì¸.", "4": "ë°œì£¼ ë³¸ê²©í™” ì‹œ ê°€ì†."},
    49: {"2": "í˜ì‹  í…Œë§ˆ í™•ì‚°, ì´ˆê¸° ë¶„í• .", "4": "íŒ¨ëŸ¬ë‹¤ì„ ì „í™˜ ê°€ì‹œí™” ì‹œ ê°€ì†."},
    50: {"2": "í•„ìˆ˜ ì†Œë¹„ ìˆ˜ìš” ì•ˆì • í™•ì¸.", "5": "ì¥ê¸° ë³´ìœ  ìš°ìœ„."},
    51: {"3": "ê¸‰ë“± ë³€ë™ì„± ì£¼ì˜. ë¶„í• Â·ì†ì ˆ ê·œìœ¨.", "4": "ì¬ì í™” ì‹œ ê°€ì†."},
    52: {"2": "ê´€ë§Â·ë°©ì–´ í¬ì§€ì…˜.", "5": "ì•ˆì • êµ¬ê°„ ìœ ì§€."},
    53: {"2": "ì ì§„ ì„±ì¥ í™•ì¸, ë¶„í•  ë§¤ìˆ˜.", "5": "ë³µë¦¬ êµ¬ê°„, ì¥ê¸° ë³´ìœ ."},
    55: {"2": "ì‹¤ì  í”„ë¦¬ë·° ìƒí–¥.", "4": "ì–´ë‹ ì„œí”„ë¼ì´ì¦ˆ ë™ë°˜ ê°€ì†.", "5": "í˜¸í™© í”¼í¬ ì ê²€Â·ìµì ˆ ì¼ë¶€."},
    56: {"3": "ìˆ˜ìš” íšŒë³µ ë¶ˆí™•ì‹¤ì„± ê´€ë¦¬.", "4": "ì˜ˆì•½Â·íƒ‘ë¼ì¸ ê°œì„  ì‹œ ì¶”ì¢…."},
    57: {"2": "ì¹¨íˆ¬ìœ¨ ìƒìŠ¹, ì ìœ ìœ¨ í™•ëŒ€ í™•ì¸.", "4": "ë„¤íŠ¸ì›Œí¬ íš¨ê³¼ ê°€ì† ì‹œ ì¶”ì¢…."},
    58: {"2": "ê±°ë˜ í™œì„±í™”Â·í”„ë¡œëª¨ì…˜ í™•ì¸.", "4": "ë§¤ì¶œ ê°€ì† ì‹œ ì¶”ì¢…."},
    60: {"2": "ê·œìœ¨Â·ì½”ìŠ¤íŠ¸ ì ˆê° í™•ì¸ í›„ ë§¤ìˆ˜.", "5": "íš¨ìœ¨í™” ì„±ê³¼ ì •ì°©."},
    61: {"2": "ESGÂ·ë¸Œëœë“œ ì‹ ë¢° ì§€í‘œ í™•ì¸.", "5": "í”„ë¦¬ë¯¸ì—„ ìœ ì§€, ë°°ë‹¹/ì•ˆì •."},
    62: {"3": "ë‹¨ê¸° ê¸‰ë“±ë½. ì†Œì•¡Â·ë¹ ë¥¸ ì†ì ˆ.", "ìƒ": "í”¼ë¡œ ëˆ„ì . ê´€ë§/ì²­ì‚°."},
    63: {"5": "ì™„ì„± êµ­ë©´. ìˆ˜ìµ ì‹¤í˜„ ìš°ì„ .", "ìƒ": "í›„ì† ë™ë ¥ ì•½í™” ì‹œ ì´íƒˆ."},
    64: {"ì´ˆ": "ë¯¸ì™„ ì´ˆê¸°. íƒìƒ‰ì  ì†Œì•¡ ì ‘ê·¼.", "3": "ë¶ˆí™•ì‹¤ì„± ê³ ì¡°. ë³€ë™ì„± ìµœìš°ì„  ê´€ë¦¬."},
}

def get_eff_label(hyo_no: int) -> str:
    if hyo_no not in HYO_LABEL:
        raise ValueError("íš¨ ë²ˆí˜¸ëŠ” 1~6ì´ì–´ì•¼ í•©ë‹ˆë‹¤.")
    return HYO_LABEL[hyo_no]

def build_eff_text(hx_no: int, hyo_label: str) -> str:
    """
    ìš°ì„ ìˆœìœ„:
    1) íŠ¹ì • ê´˜ Ã— íš¨ ì»¤ìŠ¤í…€ ë¬¸êµ¬
    2) DEFAULT_EFF_BASE ê¸°ë³¸ ë¬¸êµ¬
    3) ê´˜ ì„±í–¥(RISKY / POLICY / GROWTH / DEFENSIVE) ë³´ì • ë¬¸êµ¬
    """

    # 1ï¸âƒ£ ê¸°ë³¸ íš¨ ì„¤ëª… (ì•ˆì „í•˜ê²Œ)
    base_text = DEFAULT_EFF_BASE.get(hyo_label, "")

    # â‘¡ ê´˜ ê·¸ë£¹ë³„ ë³´ì • ë¬¸êµ¬
    group_text = ""

    if hx_no in RISKY:
        group_text = " ë³€ë™ì„± ë†’ì€ ê´˜ë¡œ, ë¹„ì¤‘ ê´€ë¦¬ì™€ ì†ì ˆ ê¸°ì¤€ì´ ì¤‘ìš”."
    elif hx_no in POLICY_EXPANSION:
        group_text = " ì •ì±…Â·ë°œì£¼ ëª¨ë©˜í…€ì— ë¯¼ê°í•œ êµ¬ê°„."
    elif hx_no in GROWTH_LEADER:
        group_text = " ì„±ì¥ì£¼ ì£¼ë„ íë¦„ì— í¸ìŠ¹í•  ìˆ˜ ìˆëŠ” êµ¬ê°„."
    elif hx_no in DEFENSIVE:
        group_text = " ë°©ì–´ì  ì„±ê²©ìœ¼ë¡œ í•˜ë½ ë°©ì–´ì— ì´ˆì ."

    # 2ï¸âƒ£ ê´˜ ì„±í–¥ë³„ ë³´ì • ì‚¬ì „
    if hx_no in RISKY:
        mod_map = {
            "ì´ˆ": "íƒìƒ‰ ìœ„ì£¼. ì†Œì•¡Â·ë¶„í•  í•„ìˆ˜.",
            "2": "ë¦¬ìŠ¤í¬ ì ê²€ í›„ ì†Œí­ í™•ëŒ€.",
            "3": "ì¶”ê²© ê¸ˆì§€. ì†ì ˆ -3% ì—„ê²©.",
            "4": "í™•ì¦ ì¬ë£Œ ë™ë°˜ ì‹œ ì œí•œì  ì¶”ì¢….",
            "5": "ì°¨ìµ ì¼ë¶€ ì‹¤í˜„, ë³€ë™ì„± ëŒ€ë¹„.",
            "ìƒ": "ë¦¬ìŠ¤í¬ ê¸‰ì¦. ë¹„ì¤‘ ì¶•ì†Œ/ì²­ì‚°.",
        }
    elif hx_no in POLICY_EXPANSION:
        mod_map = {
            "ì´ˆ": "ì •ì±…/ì˜ˆì‚°/ë°œì£¼ ìº˜ë¦°ë” í™•ì¸.",
            "2": "ê°€ì´ë“œë¼ì¸ ìœ¤ê³½ ì‹œ ë¶„í•  ë§¤ìˆ˜.",
            "3": "ê¸°ëŒ€ ì„ ë°˜ì˜ ì£¼ì˜.",
            "4": "ì§‘í–‰/ìˆ˜ì£¼ í™•ì • ì‹œ ê°€ì†.",
            "5": "ìˆ˜í˜œ í™•ì •. ë¹„ì¤‘ ìƒí–¥ í›„ ê´€ë¦¬.",
            "ìƒ": "í”¼í¬ì•„ì›ƒ ì‹ í˜¸ ì ê²€.",
        }
    elif hx_no in GROWTH_LEADER:
        mod_map = {
            "ì´ˆ": "ì„ í–‰ ì‹ í˜¸ í¬ì°© ì‹œ ì†ŒëŸ‰ ì„ ì .",
            "2": "ê¸°ê´€ ìˆ˜ê¸‰Â·ì‹¤ì  ìƒí–¥ í™•ì¸.",
            "3": "ê³¼ì—´ ê°ì‹œÂ·ë¶„í•  ëŒ€ì‘.",
            "4": "ì‹ ê³ ê°€/ì „ê³  ëŒíŒŒ ì¶”ì¢….",
            "5": "ì£¼ë„ í™•ì •, ì¼ë¶€ ìµì ˆ.",
            "ìƒ": "ì˜¤ë²„ìŠˆíŒ… ê²½ê³„, ì´ìµ ì ê¸ˆ.",
        }
    elif hx_no in DEFENSIVE:
        mod_map = {
            "ì´ˆ": "ê´€ë§Â·ë°©ì–´ í¬ì§€ì…˜.",
            "2": "ë°°ë‹¹/í˜„ê¸ˆíë¦„ í™•ì¸ í›„ ë§¤ìˆ˜.",
            "3": "ë‚®ì€ ë³€ë™ì„± ìœ ì§€.",
            "4": "ì™„ë§Œí•œ ìƒìŠ¹ ì¶”ì¢….",
            "5": "ì•ˆì • ì„±ìˆ™, ë³´ìœ  ìš°ìœ„.",
            "ìƒ": "ì„±ê³¼ ì‹¤í˜„Â·ë¦¬ë°¸ëŸ°ì‹±.",
        }
    else:
        mod_map = {}

    # 3ï¸âƒ£ ì„±í–¥ ë³´ì • ë¬¸êµ¬
    mod_text = mod_map.get(hyo_label, "")

    # 4ï¸âƒ£ íŠ¹ì • ê´˜ Ã— íš¨ ì»¤ìŠ¤í…€ ë¬¸êµ¬ (ìµœìš°ì„ )
    custom_text = CUSTOM_HYO_TEXT.get(hx_no, {}).get(hyo_label)

    if custom_text:
        # ì»¤ìŠ¤í…€ + ì„±í–¥ ë³´ì • (ì›í•˜ë©´ ì—¬ê¸°ì„œ base_textë„ ë¶™ì¼ ìˆ˜ ìˆìŒ)
        return f"[íŠ¹ì§•] {custom_text} {base_text  }   \n[ì„±í–¥] {group_text} {mod_text}".strip()

    # 5ï¸âƒ£ ê¸°ë³¸ + ì„±í–¥ ë³´ì •
    if base_text and mod_text:
        return f"{base_text} {mod_text}"

    return base_text or mod_text


def pick_sector_stocks(sectors: List[str], top_k: int = 5) -> Dict[str, List[str]]:
    return {s: SECTOR_STOCKS.get(s, [])[:top_k] for s in sectors}

def score_signal(hx_no: int, hyo_label: str) -> Dict:
    score = 50  # ì¤‘ë¦½ ê¸°ì¤€

    # íš¨ ë‹¨ê³„ ì˜í–¥
    hyo_weight = {
        "ì´ˆ": -10,
        "2": 0,
        "3": -5,
        "4": +10,
        "5": +15,
        "ìƒ": -20,
    }
    score += hyo_weight.get(hyo_label, 0)

    # ê´˜ ì„±í–¥ ì˜í–¥
    if hx_no in GROWTH_LEADER:
        score += 15
    elif hx_no in POLICY_EXPANSION:
        score += 10
    elif hx_no in DEFENSIVE:
        score += 5
    elif hx_no in RISKY:
        score -= 15

    # ì ìˆ˜ í´ë¨í”„
    score = max(0, min(100, score))

    # í–‰ë™ ê²°ì •
    if score >= 70:
        action = "ë§¤ìˆ˜"
    elif score >= 45:
        action = "ê´€ë§"
    else:
        action = "ë§¤ë„"

    return {
        "score": score,
        "action": action,
    }

def build_ai_summary(
    tendency: str,
    hyo_label: str,
    action: str
) -> str:
    templates = {
        ("ì„±ì¥/ì£¼ë„", "ë§¤ìˆ˜"): "ì£¼ë„ íë¦„ì´ í™•ì¸ë˜ëŠ” êµ¬ê°„ìœ¼ë¡œ, ì¶”ì„¸ ì¶”ì¢… ì „ëµì´ ìœ íš¨í•©ë‹ˆë‹¤.",
        ("ì •ì±…/í™•ì¥", "ë§¤ìˆ˜"): "ì •ì±… ëª¨ë©˜í…€ì´ ê°€ì‹œí™”ë˜ëŠ” ë‹¨ê³„ë¡œ, ë¶„í•  ì ‘ê·¼ì´ ìœ ë¦¬í•©ë‹ˆë‹¤.",
        ("ìœ„í—˜/ê³ ë³€ë™", "ê´€ë§"): "ë³€ë™ì„±ì´ ì»¤ì§„ êµ­ë©´ìœ¼ë¡œ, ì‹ í˜¸ í™•ì¸ ì „ ê´€ë§ì´ í•©ë¦¬ì ì…ë‹ˆë‹¤.",
        ("ìœ„í—˜/ê³ ë³€ë™", "ë§¤ë„"): "ê³¼ì—´ ë¦¬ìŠ¤í¬ê°€ ë†’ì•„ ë°©ì–´ì  ëŒ€ì‘ì´ í•„ìš”í•©ë‹ˆë‹¤.",
        ("ë°©ì–´/ì•ˆì •", "ê´€ë§"): "ì•ˆì • íë¦„ì´ì§€ë§Œ ê¸°ëŒ€ìˆ˜ìµì€ ì œí•œì ì…ë‹ˆë‹¤.",
    }

    return templates.get(
        (tendency, action),
        f"{hyo_label}íš¨ êµ­ë©´ì—ì„œ {action} ê´€ì ì˜ ì „ëµì  ëŒ€ì‘ì´ ì ì ˆí•©ë‹ˆë‹¤."
    )

def explain_signal(hx_no: int, hyo_no: int, top_k: int = 5) -> Dict:
    meta = HEXAGRAM_META[hx_no]
    hyo_label = get_eff_label(hyo_no)

    eff_text = build_eff_text(hx_no, hyo_label)
    sector_map = pick_sector_stocks(meta["sectors"], top_k)

    # ì„±í–¥
    if hx_no in RISKY:
        tendency = "ìœ„í—˜/ê³ ë³€ë™"
    elif hx_no in POLICY_EXPANSION:
        tendency = "ì •ì±…/í™•ì¥"
    elif hx_no in GROWTH_LEADER:
        tendency = "ì„±ì¥/ì£¼ë„"
    elif hx_no in DEFENSIVE:
        tendency = "ë°©ì–´/ì•ˆì •"
    else:
        tendency = "ì¤‘ë¦½"

    # ì ìˆ˜ & ì•¡ì…˜
    score_info = score_signal(hx_no, hyo_label)

    # AI ìš”ì•½
    ai_summary = build_ai_summary(
        tendency,
        hyo_label,
        score_info["action"]
    )

    return {
        "hexagram": {
            "no": hx_no,
            "name": meta["name"],
            "hanja": meta["hanja"],
            "tendency": tendency,
        },
        "hyo": {
            "label": hyo_label,
            "text": eff_text,
        },
        "signal": score_info,
        "ai_summary": ai_summary,
        "sector_stocks": sector_map,
    }


# # 5) ìë™ ì—…ë°ì´íŠ¸ í›…: ì„¹í„°ë³„ ê±°ë˜ëŒ€ê¸ˆ ìƒìœ„ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ë¡œ ê°±ì‹ 
# def update_sector_stocks_from_api(fetcher: Callable[[str, int], List[str]], top_n: int = 15) -> None:
#     """
#     fetcher(sector_label, top_n) -> ["ì¢…ëª©ëª…(ì½”ë“œ)", ...]
#     """
#     for sector in list(SECTOR_STOCKS.keys()):
#         try:
#             new_list = fetcher(sector, top_n)
#             if isinstance(new_list, list) and new_list:
#                 SECTOR_STOCKS[sector] = new_list
#         except Exception:
#             # ì„¹í„° ë¯¸ì§€ì›Â·ì˜¤ë¥˜ ì‹œ ê¸°ì¡´ ê°’ ìœ ì§€
#             pass

# # 6) ì½˜ì†” ì…ë ¥ì°½
# def input_int(prompt: str, min_v: int, max_v: int) -> int:
#     while True:
#         try:
#             v = int(input(prompt))
#             if not (min_v <= v <= max_v):
#                 print(f"ê°’ì€ {min_v}~{max_v} ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.")
#                 continue
#             return v
#         except ValueError:
#             print("ìˆ«ìë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.")

# def main():
#     print("=== ì£¼ì—­ ê´˜(1~64)Â·íš¨(1~6) ê¸°ë°˜ ì„¹í„°/ì‹œê·¸ë„ ì•ˆë‚´ ===")
#     hx_no = input_int("ê´˜ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (1~64): ", 1, 64)
#     hyo_no = input_int("íš¨ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (1~6): ", 1, 6)
#     top_k = input_int("ì„¹í„°ë³„ ëŒ€í‘œ ì¢…ëª© í‘œê¸° ê°œìˆ˜(1~20 ê¶Œì¥): ", 1, 50)
#     try:
#         res = explain_signal(hx_no, hyo_no, top_k=top_k)
#     except ValueError as e:
#         print(f"ì˜¤ë¥˜: {e}")
#         return
#     print("\n--- ê²°ê³¼ ---")
#     print(res["explanation"])
#     print("\nì„¹í„°ë³„ ëŒ€í‘œ ì¢…ëª©:")
#     for sector, lst in res["sector_stocks"].items():
#         print(f"- {sector}: {', '.join(lst) if lst else 'ë“±ë¡ ì—†ìŒ'}")

# if __name__ == "__main__":
#     main()

TENDENCY_STYLE = {
    "ì„±ì¥/ì£¼ë„": {"color": "#15803D", "emoji": "ğŸš€"},
    "ì •ì±…/í™•ì¥": {"color": "#1D4ED8", "emoji": "ğŸ›ï¸"},
    "ë°©ì–´/ì•ˆì •": {"color": "#0F766E", "emoji": "ğŸ›¡ï¸"},
    "ìœ„í—˜/ê³ ë³€ë™": {"color": "#B91C1C", "emoji": "âš ï¸"},
    "ì¤‘ë¦½": {"color": "#374151", "emoji": "â–"},
}

# ========= Streamlit UI =========
import streamlit as st
import pandas as pd

st.set_page_config(
    page_title="ì£¼ì—­ 64ê´˜ Ã— 6íš¨ ì£¼ì‹ ì„¹í„° ë§¤í•‘",
    layout="centered"
)

# st.title("ğŸ“Š ì£¼ì—­ 64ê´˜ Ã— 6íš¨ â†’ ì„¹í„° / ì¢…ëª© / ì‹œê·¸ë„")
# st.caption("í•˜ê´˜ì™€ ìƒê´˜ë¥¼ ì„ íƒí•˜ë©´ ê´˜ê°€ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.")
st.markdown(
    """
    <h2 style="
        color: #3B5BDB;
        font-weight: 700;
        margin-bottom: 0.3em;
    ">
        ğŸ“Š ì£¼ì—­ 64ê´˜ Ã— 6íš¨ â†’ ì„¹í„° / ì¢…ëª© / ì‹œê·¸ë„
    </h2>
    """,
    unsafe_allow_html=True
)

st.markdown(
    """
    <p style="
        color: #6B7280;
        font-size: 0.95rem;
        margin-top: -8px;
    ">
        ê´˜ì™€ íš¨ë¥¼ ì„ íƒí•˜ì‹œë©´, í•´ë‹¹ ì„¹í„°ì™€ ëŒ€í‘œ ì¢…ëª©, ì‹œê·¸ë„ ì„¤ëª…ì„ ì¹´ë“œ í˜•íƒœë¡œ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤.
    </p>
    """,
    unsafe_allow_html=True
)

# -------------------------
# 1ï¸âƒ£ í•˜ê´˜ / ìƒê´˜ ì„ íƒ
# -------------------------
st.subheader("â‘  ê´˜ ìƒì„±")

col1, col2 = st.columns(2)

with col1:
    low_hx_no = st.selectbox(
        "í•˜ê´˜ (ä¸‹å¦)",
        options=range(1, 9),
        format_func=lambda x: f"{x}"
    )

with col2:
    high_hx_no = st.selectbox(
        "ìƒê´˜ (ä¸Šå¦)",
        options=range(1, 9),
        format_func=lambda x: f"{x}"
    )
# (í•˜ê´˜, ìƒê´˜) -> ê´˜ ë²ˆí˜¸
    low_high_hx_no = {
    (1,1):1,   (1,2):43, (1,3):14, (1,4):34, (1,5):9,  (1,6):5,  (1,7):26, (1,8):11,
    (2,1):10,  (2,2):58, (2,3):38, (2,4):54, (2,5):61, (2,6):60, (2,7):41, (2,8):19,
    (3,1):13,  (3,2):49, (3,3):30, (3,4):55, (3,5):37, (3,6):63, (3,7):22, (3,8):36,
    (4,1):25,  (4,2):17, (4,3):21, (4,4):51, (4,5):42, (4,6):3,  (4,7):27, (4,8):24,
    (5,1):44,  (5,2):28, (5,3):50, (5,4):32, (5,5):57, (5,6):48, (5,7):18, (5,8):46,
    (6,1):6,   (6,2):47, (6,3):64, (6,4):40, (6,5):59, (6,6):29, (6,7):4,  (6,8):7,
    (7,1):33,  (7,2):31, (7,3):56, (7,4):62, (7,5):53, (7,6):39, (7,7):52, (7,8):15,
    (8,1):12,  (8,2):45, (8,3):35, (8,4):16, (8,5):20, (8,6):8,  (8,7):23, (8,8):2
    }
# -------------------------
# 2ï¸âƒ£ ê´˜ ìë™ ê³„ì‚°
# -------------------------
hx_no = low_high_hx_no[(low_hx_no, high_hx_no)]
hx_meta = HEXAGRAM_META[hx_no]

with st.container(border=True):
    st.markdown("### ğŸ”® ìƒì„±ëœ ê´˜")
    col_a, col_b, col_c = st.columns(3)

    col_a.metric("ê´˜ ë²ˆí˜¸", hx_no)
    col_b.metric("ê´˜ ì´ë¦„", hx_meta["name"])
    col_c.metric("í•œì", hx_meta["hanja"])

# -------------------------
# 3ï¸âƒ£ íš¨ / ì˜µì…˜ ì„ íƒ
# -------------------------
st.subheader("â‘¡ íš¨ ë° ì˜µì…˜ ì„ íƒ")

col3, col4 = st.columns([1, 2])

with col3:
    hyo_no = st.radio(
        "íš¨ ë²ˆí˜¸",
        options=[1,2,3,4,5,6],
        horizontal=True
    )

with col4:
    top_k = st.slider(
        "ì„¹í„°ë³„ ëŒ€í‘œ ì¢…ëª© ìˆ˜",
        min_value=3,
        max_value=12,
        value=6
    )

# -------------------------
# 4ï¸âƒ£ ê²°ê³¼ ì¶œë ¥
# -------------------------
st.divider()

if st.button("ğŸ“ˆ ì‹œê·¸ë„ í•´ì„ ë³´ê¸°", use_container_width=True):
    res = explain_signal(hx_no, hyo_no, top_k)

    style = TENDENCY_STYLE[res["hexagram"]["tendency"]]

    st.markdown(
        f"""
        <div style="
            border-left: 6px solid {style['color']};
            padding: 12px;
            margin-bottom: 12px;
            background-color: #F9FAFB;
        ">
            <h3 style="margin:0;">
                {style['emoji']} {res['hexagram']['name']} ({res['hexagram']['hanja']})
            </h3>
            <p style="margin:4px 0;">
                AIì¢…í•©: <b>{res['hexagram']['tendency']}</b>
            </p>
            <p>{res['ai_summary']}</p>
        </div>
        """,
        unsafe_allow_html=True
    )

    st.metric(
        "ì‹œê·¸ë„ ì ìˆ˜",
        res["signal"]["score"],
        delta=res["signal"]["action"]
    )

    st.info(res["hyo"]["text"])


    for sector, stocks in res["sector_stocks"].items():
        with st.container(border=True):
            st.markdown(f"### ğŸ·ï¸ {sector}")
            df = pd.DataFrame({"ëŒ€í‘œ ì¢…ëª©": stocks})
            st.dataframe(df, use_container_width=True, hide_index=True)
